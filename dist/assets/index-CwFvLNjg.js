import d from"./index-CKUPzP3V.js";let c=window.AudioContext||window.webkitAudioContext,p=i=>{let e=i.toString().replace(/^(\(\)\s*=>|function\s*\(\))\s*{/,"").replace(/}$/,""),r=new Blob([e]);return new Worker(URL.createObjectURL(r))},n=i=>{let e=new Event("error");return e.data=new Error("Wrong state for "+i),e},t;class s{constructor(e,r=null){this.stream=e,this.config=r,this.state="inactive",this.em=document.createDocumentFragment(),this.encoder=p(s.encoder);let a=this;this.encoder.addEventListener("message",h=>{let o=new Event("dataavailable");o.data=new Blob([h.data],{type:a.mimeType}),a.em.dispatchEvent(o),a.state==="inactive"&&a.em.dispatchEvent(new Event("stop"))})}start(e){if(this.state!=="inactive")return this.em.dispatchEvent(n("start"));this.state="recording",t||(t=new c(this.config)),this.clone=this.stream.clone(),this.input=t.createMediaStreamSource(this.clone),this.processor=t.createScriptProcessor(2048,1,1),this.encoder.postMessage(["init",t.sampleRate]),this.processor.onaudioprocess=r=>{this.state==="recording"&&this.encoder.postMessage(["encode",r.inputBuffer.getChannelData(0)])},this.input.connect(this.processor),this.processor.connect(t.destination),this.em.dispatchEvent(new Event("start")),e&&(this.slicing=setInterval(()=>{this.state==="recording"&&this.requestData()},e))}stop(){return this.state==="inactive"?this.em.dispatchEvent(n("stop")):(this.requestData(),this.state="inactive",this.clone.getTracks().forEach(e=>{e.stop()}),this.processor.disconnect(),this.input.disconnect(),clearInterval(this.slicing))}pause(){return this.state!=="recording"?this.em.dispatchEvent(n("pause")):(this.state="paused",this.em.dispatchEvent(new Event("pause")))}resume(){return this.state!=="paused"?this.em.dispatchEvent(n("resume")):(this.state="recording",this.em.dispatchEvent(new Event("resume")))}requestData(){return this.state==="inactive"?this.em.dispatchEvent(n("requestData")):this.encoder.postMessage(["dump",t.sampleRate])}addEventListener(...e){this.em.addEventListener(...e)}removeEventListener(...e){this.em.removeEventListener(...e)}dispatchEvent(...e){this.em.dispatchEvent(...e)}}s.prototype.mimeType="audio/wav";s.isTypeSupported=i=>s.prototype.mimeType===i;s.notSupported=!navigator.mediaDevices||!c;s.encoder=d;export{s as default};
